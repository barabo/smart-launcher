(this["webpackJsonpgranular-scopes-app"]=this["webpackJsonpgranular-scopes-app"]||[]).push([[0],{118:function(e,t,n){"use strict";var r=(new(n(297).default)).getSmartApi(),a=r.ready,o=r.authorize,i=r.init,s=r.client,c=r.options;if("undefined"==typeof FHIRCLIENT_PURE){var u=n(338);n(339),window.fetch||(window.fetch=u.default,window.Headers=u.Headers,window.Request=u.Request,window.Response=u.Response)}var l={AbortController:window.AbortController,client:s,oauth2:{settings:c,ready:a,authorize:o,init:i}};e.exports=l},150:function(e,t,n){"use strict";n.r(t),n.d(t,"units",(function(){return l})),n.d(t,"checkResponse",(function(){return p})),n.d(t,"responseToJSON",(function(){return h})),n.d(t,"request",(function(){return m})),n.d(t,"getAndCache",(function(){return v})),n.d(t,"fetchConformanceStatement",(function(){return g})),n.d(t,"humanizeError",(function(){return b})),n.d(t,"getPath",(function(){return y})),n.d(t,"setPath",(function(){return S})),n.d(t,"makeArray",(function(){return w})),n.d(t,"absolute",(function(){return E})),n.d(t,"randomString",(function(){return O})),n.d(t,"jwtDecode",(function(){return x})),n.d(t,"getAccessTokenExpiration",(function(){return R})),n.d(t,"byCode",(function(){return T})),n.d(t,"byCodes",(function(){return C})),n.d(t,"getPatientParam",(function(){return I})),n.d(t,"getTargetWindow",(function(){return _}));var r=n(7),a=n.n(r),o=n(11),i=n(299),s=n(83),c=(n(300),console.log),u={},l={cm:function(e){var t=e.code,n=e.value;if(d({code:t,value:n}),"cm"==t)return n;if("m"==t)return 100*n;if("in"==t)return 2.54*n;if("[in_us]"==t)return 2.54*n;if("[in_i]"==t)return 2.54*n;if("ft"==t)return 30.48*n;if("[ft_us]"==t)return 30.48*n;throw new Error("Unrecognized length unit: "+t)},kg:function(e){var t=e.code,n=e.value;if(d({code:t,value:n}),"kg"==t)return n;if("g"==t)return n/1e3;if(t.match(/lb/))return n/2.20462;if(t.match(/oz/))return n/35.274;throw new Error("Unrecognized weight unit: "+t)},any:function(e){return d(e),e.value}};function d(e){var t=e.value,n=e.code;if("number"!==typeof t)throw new Error("Found a non-numerical unit: "+t+" "+n)}function p(e){return f.apply(this,arguments)}function f(){return(f=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=4;break}return e.next=3,b(t);case 3:throw e.sent;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return e.text().then((function(e){return e.length?JSON.parse(e):""}))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,Object.assign(Object.assign({mode:"cors"},t),{headers:Object.assign({accept:"application/json"},t.headers)})).then(p).then((function(e){var t=e.headers.get("Content-Type")+"";return t.match(/\bjson\b/i)?h(e).then((function(t){return{res:e,body:t}})):t.match(/^text\//i)?e.text().then((function(t){return{res:e,body:t}})):{res:e}})).then((function(e){var n=e.res,r=e.body;if(!r&&201==n.status){var a=n.headers.get("location")+"";if(a)return m(a,Object.assign(Object.assign({},t),{method:"GET",body:null}))}return void 0===r?n:r}))}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||!u[e]?(u[e]=m(e,t),u[e]):Promise.resolve(u[e])}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1?arguments[1]:void 0,n=String(e).replace(/\/*$/,"/")+"metadata";return v(n,t).catch((function(e){throw new Error('Failed to fetch the conformance statement from "'.concat(n,'". ').concat(e))}))}function b(e){return k.apply(this,arguments)}function k(){return(k=Object(o.a)(a.a.mark((function e(t){var n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="".concat(t.status," ").concat(t.statusText,"\nURL: ").concat(t.url),r=null,e.prev=2,!(o=t.headers.get("Content-Type")||"text/plain").match(/\bjson\b/i)){e.next=11;break}return e.next=7,t.json();case 7:(r=e.sent).error?(n+="\n"+r.error,r.error_description&&(n+=": "+r.error_description)):n+="\n\n"+JSON.stringify(r,null,4),e.next=16;break;case 11:if(!o.match(/^text\//i)){e.next=16;break}return e.next=14,t.text();case 14:(r=e.sent)&&(n+="\n\n"+r);case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(2);case 20:throw new i.default(n,t.status,t.statusText,r);case 21:case"end":return e.stop()}}),e,null,[[2,18]])})))).apply(this,arguments)}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(t=t.trim()))return e;for(var n=t.split("."),r=e;r&&n.length;){var a=n.shift();if(!a&&Array.isArray(r))return r.map((function(e){return y(e,n.join("."))}));r=r[a]}return r}function S(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.trim().split(".").reduce((function(e,t,a,o){if(!e||a!==o.length-1)return e&&void 0===e[t]&&r&&(e[t]=o[a+1].match(/^[0-9]+$/)?[]:{}),e?e[t]:void 0;e[t]=n}),e),e}function w(e){return Array.isArray(e)?e:[e]}function E(e,t){return e.match(/^http/)||e.match(/^urn/)?e:String(t||"").replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")}function O(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=[],r=t.length;e--;)n.push(t.charAt(Math.floor(Math.random()*r)));return n.join("")}function x(e,t){var n=e.split(".")[1];return n?JSON.parse(t.atob(n)):null}function R(e,t){var n=Math.floor(Date.now()/1e3);if(e.expires_in)return n+e.expires_in;if(e.access_token){var r=x(e.access_token,t);if(r&&r.exp)return r.exp}return n+300}function T(e,t){var n={};function r(e,t){e&&Array.isArray(e.coding)&&e.coding.forEach((function(e){var r=e.code;r&&(n[r]=n[r]||[],n[r].push(t))}))}return w(e).forEach((function(e){"Observation"===e.resourceType&&e[t]&&(Array.isArray(e[t])?e[t].forEach((function(t){return r(t,e)})):r(e[t],e))})),n}function C(e,t){var n=T(e,t);return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((function(e){return e+""in n})).reduce((function(e,t){return e.concat(n[t+""])}),[])}}function I(e,t){var n=(y(e,"rest.0.resource")||[]).find((function(e){return e.type===t}));if(!n)throw new Error('Resource "'.concat(t,'" is not supported by this FHIR server'));if(!Array.isArray(n.searchParam))throw new Error('No search parameters supported for "'.concat(t,'" on this FHIR server'));if("Patient"==t&&n.searchParam.find((function(e){return"_id"==e.name})))return"_id";var r=s.patientParams.find((function(e){return n.searchParam.find((function(t){return t.name==e}))}));if(!r)throw new Error("I don't know what param to use for "+t);return r}function _(e){return j.apply(this,arguments)}function j(){return(j=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s,u,l,d=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:800,r=d.length>2&&void 0!==d[2]?d[2]:720,"function"!=typeof t){e.next=6;break}return e.next=5,t();case 5:t=e.sent;case 6:if(!t||"object"!=typeof t){e.next=8;break}return e.abrupt("return",t);case 8:if("string"==typeof t){e.next=11;break}return c("Invalid target type '%s'. Failing back to '_self'.",typeof t),e.abrupt("return",self);case 11:if("_self"!=t){e.next=13;break}return e.abrupt("return",self);case 13:if("_parent"!=t){e.next=15;break}return e.abrupt("return",parent);case 15:if("_top"!=t){e.next=17;break}return e.abrupt("return",top);case 17:if("_blank"!=t){e.next=34;break}if(i=null,e.prev=19,i=window.open("","SMARTAuthPopup")){e.next=23;break}throw new Error("Perhaps window.open was blocked");case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(19),o=e.t0;case 28:if(i){e.next=33;break}return c("Cannot open window. Failing back to '_self'. %s",o),e.abrupt("return",self);case 33:return e.abrupt("return",i);case 34:if("popup"!=t){e.next=51;break}if(u=null,e.prev=36,u=window.open("","SMARTAuthPopup",["height="+r,"width="+n,"menubar=0","resizable=1","status=0","top="+(screen.height-r)/2,"left="+(screen.width-n)/2].join(","))){e.next=40;break}throw new Error("Perhaps the popup window was blocked");case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(36),s=e.t1;case 45:if(u){e.next=50;break}return c("Cannot open window. Failing back to '_self'. %s",s),e.abrupt("return",self);case 50:return e.abrupt("return",u);case 51:if(!(l=frames[t])){e.next=54;break}return e.abrupt("return",l);case 54:return c("Unknown target '%s'. Failing back to '_self'.",t),e.abrupt("return",self);case 56:case"end":return e.stop()}}),e,null,[[19,25],[36,42]])})))).apply(this,arguments)}},152:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var r=n(7),a=n.n(r),o=n(19),i=n(20),s=n(11);n(308),n(330);var c=n(150),u=n(336),l=n(83),d=console.log;function p(e,t){return f.apply(this,arguments)}function f(){return(f=Object(s.a)(a.a.mark((function e(t,n){var r,o,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(){return(i=Object(s.a)(a.a.mark((function e(t){var r,o,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.pathname.split("/").pop()){e.next=3;break}throw new Error('Invalid url "'.concat(t,'"'));case 3:if(-1!=l.patientCompartment.indexOf(r)){e.next=5;break}throw new Error('Cannot filter "'.concat(r,'" resources by patient'));case 5:return e.next=7,c.fetchConformanceStatement(n.state.serverUrl);case 7:return o=e.sent,i=c.getPatientParam(o,r),t.searchParams.set(i,n.patient.id),e.abrupt("return",t.href);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)},o=function(e){return i.apply(this,arguments)},r=c.absolute("/",n.state.serverUrl),!("string"==typeof t||t instanceof URL)){e.next=8;break}return e.next=6,o(new URL(t+"",r));case 6:return e.t0=e.sent,e.abrupt("return",{url:e.t0});case 8:return e.next=10,o(new URL(t.url+"",r));case 10:return t.url=e.sent,e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t,n,r,a,o){var i=c.getPath(e,t);if(i){var s=Array.isArray(i);return Promise.all(c.makeArray(i).filter(Boolean).map((function(i,u){var l=i.reference;if(l)return function(e,t,n,r){return t[e]||(t[e]=n.request({url:e,signal:r}).then((function(n){return t[e]=n,n}),(function(n){throw delete t[e],n}))),Promise.resolve(t[e])}(l,r,a,o).then((function(r){n&&(s?t.indexOf("..")>-1?c.setPath(e,"".concat(t.replace("..",".".concat(u,"."))),r):c.setPath(e,"".concat(t,".").concat(u),r):c.setPath(e,t,r))})).catch((function(e){if(404!==e.status)throw e}))})))}}function m(e,t,n,r,a){var o=c.makeArray(t.resolveReferences).filter(Boolean).map((function(e){return String(e).trim()})).filter(Boolean);if(!(o=o.filter((function(e,t){return!(o.indexOf(e,t+1)>-1)||(d('Duplicated reference path "%s"',e),!1)}))).length)return Promise.resolve();var i={};o.forEach((function(e){var t=e.split(".").length;i[t]||(i[t]=[]),i[t].push(e)}));var s=Promise.resolve();return Object.keys(i).sort().forEach((function(o){var c=i[o];s=s.then((function(){return Promise.all(c.map((function(o){return h(e,o,!!t.graph,n,r,a)})))}))})),s}var v=function(){function e(t,n){var r=this;Object(o.a)(this,e),this.units=c.units;var i="string"==typeof n?{serverUrl:n}:n;if(!i.serverUrl||!i.serverUrl.match(/https?:\/\/.+/))throw new Error('A "serverUrl" option is required and must begin with "http(s)"');this.state=i,this.environment=t,this._refreshTask=null;var u=this;this.patient={get id(){return u.getPatientId()},read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.patient.id;return t?r.request(Object.assign(Object.assign({},e),{url:"Patient/".concat(t)})):Promise.reject(new Error("Patient is not available"))},request:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.patient.id?Object(s.a)(a.a.mark((function n(){var o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p(e,r);case 2:return o=n.sent,n.abrupt("return",r.request(o,t));case 4:case"end":return n.stop()}}),n)})))():Promise.reject(new Error("Patient is not available"))}},this.encounter={get id(){return u.getEncounterId()},read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.encounter.id;return t?r.request(Object.assign(Object.assign({},e),{url:"Encounter/".concat(t)})):Promise.reject(new Error("Encounter is not available"))}},this.user={get fhirUser(){return u.getFhirUser()},get id(){return u.getUserId()},get resourceType(){return u.getUserType()},read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.user.fhirUser;return t?r.request(Object.assign(Object.assign({},e),{url:t})):Promise.reject(new Error("User is not available"))}},this.connect(t.fhir)}return Object(i.a)(e,[{key:"connect",value:function(e){if("function"==typeof e){var t={baseUrl:this.state.serverUrl.replace(/\/$/,"")},n=this.getState("tokenResponse.access_token");if(n)t.auth={token:n};else{var r=this.state,a=r.username,o=r.password;a&&o&&(t.auth={user:a,pass:o})}this.api=e(t);var i=this.getState("tokenResponse.patient");i&&(this.patient.api=e(Object.assign(Object.assign({},t),{patient:i})))}return this}},{key:"getPatientId",value:function(){var e=this.state.tokenResponse;return e?e.patient?e.patient:((this.state.scope||"").match(/\blaunch(\/patient)?\b/)?d("The ID of the selected patient is not available. Please check if your server supports that."):d(u.default.noScopeForId,"patient","patient"),null):(this.state.authorizeUri?d(u.default.noIfNoAuth,"the ID of the selected patient"):d(u.default.noFreeContext,"selected patient"),null)}},{key:"getEncounterId",value:function(){var e=this.state.tokenResponse;return e?e.encounter?e.encounter:((this.state.scope||"").match(/\blaunch(\/encounter)?\b/)?d("The ID of the selected encounter is not available. Please check if your server supports that, and that the selected patient has any recorded encounters."):d(u.default.noScopeForId,"encounter","encounter"),null):(this.state.authorizeUri?d(u.default.noIfNoAuth,"the ID of the selected encounter"):d(u.default.noFreeContext,"selected encounter"),null)}},{key:"getIdToken",value:function(){var e=this.state.tokenResponse;if(e){var t=e.id_token,n=this.state.scope||"";if(!t){var r=n.match(/\bopenid\b/),a=n.match(/\bprofile\b/),o=n.match(/\bfhirUser\b/);return d(r&&(o||a)?"The id_token is not available. Please check if your server supports that.":"You are trying to get the id_token but you are not using the right scopes. Please add 'openid' and 'fhirUser' or 'profile' to the scopes you are requesting."),null}return c.jwtDecode(t,this.environment)}return this.state.authorizeUri?d(u.default.noIfNoAuth,"the id_token"):d(u.default.noFreeContext,"id_token"),null}},{key:"getFhirUser",value:function(){var e=this.getIdToken();return e?e.profile:null}},{key:"getUserId",value:function(){var e=this.getFhirUser();return e?e.split("/")[1]:null}},{key:"getUserType",value:function(){var e=this.getFhirUser();return e?e.split("/")[0]:null}},{key:"getAuthorizationHeader",value:function(){var e=this.getState("tokenResponse.access_token");if(e)return"Bearer "+e;var t=this.state,n=t.username,r=t.password;return n&&r?"Basic "+this.environment.btoa(n+":"+r):null}},{key:"_clearState",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.environment.getStorage(),e.next=3,t.get(l.SMART_KEY);case 3:if(!(n=e.sent)){e.next=7;break}return e.next=7,t.unset(n);case 7:return e.next=9,t.unset(l.SMART_KEY);case 9:this.state.tokenResponse={};case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(Object.assign(Object.assign({},t),{url:"".concat(e.resourceType),method:"POST",body:JSON.stringify(e),headers:Object.assign({"Content-Type":"application/json"},t.headers)}))}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(Object.assign(Object.assign({},t),{url:"".concat(e.resourceType,"/").concat(e.id),method:"PUT",body:JSON.stringify(e),headers:Object.assign({"Content-Type":"application/json"},t.headers)}))}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(Object.assign(Object.assign({},t),{url:e,method:"DELETE"}))}},{key:"request",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r,o,i,l,d,p,f,h=this,v=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:{},r=v.length>2&&void 0!==v[2]?v[2]:{},i=console.log,t){e.next=5;break}throw new Error("request requires an url or request options as argument");case 5:return"string"==typeof t||t instanceof URL?(l=String(t),t={}):l=String(t.url),l=c.absolute(l,this.state.serverUrl),d={graph:!1!==n.graph,flat:!!n.flat,pageLimit:null!==(o=n.pageLimit)&&void 0!==o?o:1,resolveReferences:n.resolveReferences||[],useRefreshToken:!1!==n.useRefreshToken,onPage:"function"==typeof n.onPage?n.onPage:void 0},p=t.signal||void 0,f=d.useRefreshToken?this.refreshIfNeeded({signal:p}).then((function(){return t})):Promise.resolve(t),e.abrupt("return",f.then((function(e){var t=h.getAuthorizationHeader();return t&&(e.headers=Object.assign(Object.assign({},e.headers),{Authorization:t})),e})).then((function(e){return i("%s, options: %O, fhirOptions: %O",l,e,d),c.request(l,e)})).catch(function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(401!=t.status){e.next=12;break}if(h.getState("tokenResponse.access_token")){e.next=3;break}throw new Error("This app cannot be accessed directly. Please launch it as SMART app!");case 3:if(d.useRefreshToken){e.next=8;break}return i("Your session has expired and the useRefreshToken option is set to false. Please re-launch the app."),e.next=7,h._clearState();case 7:throw new Error(u.default.expired);case 8:return i("Auto-refresh failed! Please re-launch the app."),e.next=11,h._clearState();case 11:throw new Error(u.default.expired);case 12:throw t;case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw 403==e.status&&i("Permission denied! Please make sure that you have requested the proper scopes."),e})).then((function(e){return e?"string"==typeof e||e instanceof Response?e:function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Bundle"!=t.resourceType){e.next=5;break}return e.next=3,Promise.all((t.entry||[]).map((function(e){return m(e.resource,d,r,h,p)})));case 3:e.next=7;break;case 5:return e.next=7,m(t,d,r,h,p);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(e).then(function(){var e=Object(s.a)(a.a.mark((function e(t){var n,o,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"Bundle"!=t.resourceType){e.next=19;break}if(n=t.link||[],d.flat&&(t=(t.entry||[]).map((function(e){return e.resource}))),!d.onPage){e.next=6;break}return e.next=6,d.onPage(t,Object.assign({},r));case 6:if(!--d.pageLimit){e.next=19;break}if(o=n.find((function(e){return"next"==e.relation})),t=c.makeArray(t),!o||!o.url){e.next=19;break}return e.next=12,h.request({url:o.url,signal:p},d,r);case 12:if(i=e.sent,!d.onPage){e.next=15;break}return e.abrupt("return",null);case 15:if(!d.resolveReferences.length){e.next=18;break}return Object.assign(r,i.references),e.abrupt("return",t.concat(c.makeArray(i.data||i)));case 18:return e.abrupt("return",t.concat(c.makeArray(i)));case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){if(d.graph)r={};else if(!d.onPage&&d.resolveReferences.length)return{data:e,references:r};return e})):e})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshIfNeeded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getState("tokenResponse.access_token"),n=this.getState("tokenResponse.refresh_token"),r=this.state.expiresAt||0;return t&&n&&r-10<Date.now()/1e3?this.refresh(e):Promise.resolve(this.state)}},{key:"refresh",value:function(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=c.debug.extend("client:refresh");a("Attempting to refresh with refresh_token...");var o=null===(t=null===(e=this.state)||void 0===e?void 0:e.tokenResponse)||void 0===t?void 0:t.refresh_token;if(!o)throw new Error("Unable to refresh. No refresh_token found.");var i=this.state.tokenUri;if(!i)throw new Error("Unable to refresh. No tokenUri found.");var s=this.getState("tokenResponse.scope")||"",u=s.search(/\boffline_access\b/)>-1,l=s.search(/\bonline_access\b/)>-1;if(!u&&!l)throw new Error("Unable to refresh. No offline_access or online_access scope found.");if(!this._refreshTask){var d=Object.assign(Object.assign({credentials:this.environment.options.refreshTokenWithCredentials||"same-origin"},r),{method:"POST",mode:"cors",headers:Object.assign(Object.assign({},r.headers||{}),{"content-type":"application/x-www-form-urlencoded"}),body:"grant_type=refresh_token&refresh_token=".concat(encodeURIComponent(o))});if(!("authorization"in d.headers)){var p=this.state,f=p.clientSecret,h=p.clientId;f&&(d.headers.authorization="Basic "+this.environment.btoa(h+":"+f))}this._refreshTask=c.request(i,d).then((function(e){if(!e.access_token)throw new Error("No access token received");return a("Received new access token response %O",e),Object.assign(n.state.tokenResponse,e),n.state.expiresAt=c.getAccessTokenExpiration(e,n.environment),n.state})).catch((function(e){var t,r;throw(null===(r=null===(t=n.state)||void 0===t?void 0:t.tokenResponse)||void 0===r?void 0:r.refresh_token)&&(a("Deleting the expired or invalid refresh token."),delete n.state.tokenResponse.refresh_token),e})).finally((function(){n._refreshTask=null;var e=n.state.key;e?n.environment.getStorage().set(e,n.state):a("No 'key' found in Clint.state. Cannot persist the instance.")}))}return this._refreshTask}},{key:"byCode",value:function(e,t){return c.byCode(e,t)}},{key:"byCodes",value:function(e,t){return c.byCodes(e,t)}},{key:"getPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c.getPath(e,t)}},{key:"getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c.getPath(Object.assign({},this.state),e)}},{key:"getFhirVersion",value:function(){return c.fetchConformanceStatement(this.state.serverUrl).then((function(e){return e.fhirVersion}))}},{key:"getFhirRelease",value:function(){return this.getFhirVersion().then((function(e){var t;return null!==(t=l.fhirVersions[e])&&void 0!==t?t:0}))}}]),e}()},261:function(e,t,n){e.exports=n(700)},266:function(e,t,n){},267:function(e,t,n){},297:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var r=n(19),a=n(20),o=n(298),i=n(152),s=n(337),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e),this._url=null,this._storage=null,this.options=Object.assign({replaceBrowserHistory:!0,fullSessionStorageSupport:!0,refreshTokenWithCredentials:"same-origin"},t)}return Object(a.a)(e,[{key:"relative",value:function(e){return new URL(e,this.getUrl().href).href}},{key:"getUrl",value:function(){return this._url||(this._url=new URL(location+"")),this._url}},{key:"redirect",value:function(e){location.href=e}},{key:"getStorage",value:function(){return this._storage||(this._storage=new s.default),this._storage}},{key:"getAbortController",value:function(){return AbortController}},{key:"atob",value:function(e){return window.atob(e)}},{key:"btoa",value:function(e){return window.btoa(e)}},{key:"getSmartApi",value:function(){var e=this;return{ready:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o.ready.apply(o,[e].concat(n))},authorize:function(t){return o.authorize(e,t)},init:function(t){return o.init(e,t)},client:function(t){return new i.default(e,t)},options:this.options}}},{key:"fhir",get:function(){return"function"===typeof fhir?fhir:null}}]),e}()},298:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"fetchWellKnownJson",(function(){return d})),n.d(t,"getSecurityExtensions",(function(){return g})),n.d(t,"authorize",(function(){return b})),n.d(t,"isInFrame",(function(){return S})),n.d(t,"isInPopUp",(function(){return w})),n.d(t,"onMessage",(function(){return E})),n.d(t,"completeAuth",(function(){return O})),n.d(t,"buildTokenRequest",(function(){return R})),n.d(t,"ready",(function(){return T})),n.d(t,"init",(function(){return I}));var r=n(7),a=n.n(r),o=n(11),i=n(150),s=n(152),c=n(83),u=console.log;function l(){return"object"===typeof window}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1?arguments[1]:void 0,n=String(e).replace(/\/*$/,"/")+".well-known/smart-configuration";return i.getAndCache(n,t).catch((function(e){throw new Error('Failed to fetch the well-known json "'.concat(n,'". ').concat(e.message))}))}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1?arguments[1]:void 0;return d(e,t).then((function(e){if(!e.authorization_endpoint||!e.token_endpoint)throw new Error("Invalid wellKnownJson");var t=!1;return e.capabilities.includes("authorize-post")&&(t=!0),{registrationUri:e.registration_endpoint||"",authorizeUri:e.authorization_endpoint,tokenUri:e.token_endpoint,introspectionUri:e.introspection_endpoint||"",codeChallengeMethods:e.code_challenge_methods_supported,supportsPost:t}}))}function f(e){var t=e.length,n=[],r=!1;return new Promise((function(a,o){function i(e){n.push(e)===t&&o(new Error(n.map((function(e){return e.message})).join("; ")))}e.forEach((function(t){t.promise.then((function(n){return function(t,n){t.complete=!0,r||(r=!0,e.forEach((function(e){e.complete||e.controller.abort()})),a(n))}(t,n)}),i)}))}))}var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";function m(){var e=new Uint32Array(96);crypto.getRandomValues(e);var t=v(Array.from(e).map((function(e){return h[e%h.length]})).join(""));return crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t)).then((function(e){for(var t=new Uint8Array(e),n="",r=t.byteLength,a=0;a<r;a++)n+=String.fromCharCode(t[a]);return n})).then(v).then((function(e){return{codeChallenge:e,codeVerifier:t}}))}function v(t){return l()?btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""):e.Buffer.from(t).toString("base64")}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",n=e.getAbortController(),r=new n;new n;return f([{controller:r,promise:p(t,{signal:r.signal})}])}function b(e){return k.apply(this,arguments)}function k(){return(k=Object(o.a)(a.a.mark((function e(t){var n,r,o,s,d,p,f,h,v,b,k,O,x,R,T,C,I,_,j,P,A,U,N,D,q,L,M,F,z,H,B,J,G,K,V=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=V.length>1&&void 0!==V[1]?V[1]:{},r=V.length>2&&void 0!==V[2]&&V[2],o=n.redirect_uri,s=n.clientSecret,d=n.fakeTokenResponse,p=n.patientId,f=n.encounterId,h=n.client_id,v=n.target,b=n.width,k=n.height,O=n.usePKCE,x=n.usePost,R=n.iss,T=n.launch,C=n.fhirServiceUrl,I=n.redirectUri,_=n.scope,j=void 0===_?"":_,P=n.clientId,A=n.completeInTarget,U=t.getUrl(),N=t.getStorage(),R=U.searchParams.get("iss")||R,C=U.searchParams.get("fhirServiceUrl")||C,T=U.searchParams.get("launch")||T,P||(P=h),I||(I=o),I?I.match(/^https?\:\/\//)||(I=t.relative(I)):I=t.relative("."),D=String(R||C||"")){e.next=15;break}throw new Error("No server url found. It must be specified as `iss` or as `fhirServiceUrl` parameter");case 15:return R&&u("Making %s launch...",T?"EHR":"standalone"),T&&!j.match(/launch/)&&(j+=" launch"),l()&&(q=S(),L=w(),(q||L)&&!0!==A&&!1!==A&&(A=q,console.warn('Your app is being authorized from within an iframe or popup window. Please be explicit and provide a "completeInTarget" option. Use "true" to complete the authorization in the same window, or "false" to try to complete it in the parent or the opener window. See http://docs.smarthealthit.org/client-js/api.html'))),e.next=20,N.get(c.SMART_KEY);case 20:return M=e.sent,e.next=23,N.unset(M);case 23:if(F=i.randomString(16),z={clientId:P,scope:j,redirectUri:I,serverUrl:D,clientSecret:s,tokenResponse:{},key:F,completeInTarget:A},!(!l()||i.getPath(t,"options.fullSessionStorageSupport"))){e.next=29;break}return e.next=29,N.set(c.SMART_KEY,F);case 29:if(d&&Object.assign(z.tokenResponse,d),p&&Object.assign(z.tokenResponse,{patient:p}),f&&Object.assign(z.tokenResponse,{encounter:f}),H=I+"?state="+encodeURIComponent(F),!C||R){e.next=42;break}return u("Making fake launch..."),e.next=37,N.set(F,z);case 37:if(!r){e.next=39;break}return e.abrupt("return",H);case 39:return e.next=41,t.redirect(H);case 41:return e.abrupt("return",e.sent);case 42:return e.next=44,g(t,D);case 44:return B=e.sent,Object.assign(z,B),e.next=48,N.set(F,z);case 48:if(z.authorizeUri){e.next=54;break}if(!r){e.next=51;break}return e.abrupt("return",H);case 51:return e.next=53,t.redirect(H);case 53:return e.abrupt("return",e.sent);case 54:if(J=["response_type=code","client_id="+encodeURIComponent(P||""),"scope="+encodeURIComponent(j),"redirect_uri="+encodeURIComponent(I),"aud="+encodeURIComponent(D),"state="+encodeURIComponent(F)],T&&J.push("launch="+encodeURIComponent(T)),!O||!B.codeChallengeMethods.includes("S256")){e.next=65;break}return e.next=59,m();case 59:return G=e.sent,Object.assign(z,G),e.next=63,N.set(F,z);case 63:J.push("code_challenge="+z.codeChallenge),J.push("code_challenge_method=S256");case 65:if(H=z.authorizeUri+"?"+J.join("&"),!r){e.next=68;break}return e.abrupt("return",H);case 68:if(!v||!l()){e.next=77;break}return e.next=71,i.getTargetWindow(v,b,k);case 71:if((K=e.sent)!==self)try{K.sessionStorage.removeItem(M),K.sessionStorage.setItem(F,JSON.stringify(z))}catch(a){i.debug('Failed to modify window.sessionStorage. Perhaps it is from different origin?. Failing back to "_self". %s',a),K=self}if(K!==self)try{x?y(K,z.authorizeUri,J):K.location.href=H,self.addEventListener("message",E)}catch(a){i.debug('Failed to modify window.location. Perhaps it is from different origin?. Failing back to "_self". %s',a),x?y(self,z.authorizeUri,J):self.location.href=H}else x?y(self,z.authorizeUri,J):self.location.href=H;return e.abrupt("return");case 77:if(!x||!l()){e.next=80;break}return y(self,z.authorizeUri,J),e.abrupt("return");case 80:return e.next=82,t.redirect(H);case 82:return e.abrupt("return",e.sent);case 83:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,n){var r=e.document.createElement("form");e.document.body.appendChild(r),r.method="POST",r.action=t,n.forEach((function(t){var n=t.split("=");if(!(n.length<2)){var a=t.substr(n[0].length+1),o=e.document.createElement("input");o.type="hidden",o.name=n[0],o.value=decodeURIComponent(a),r.appendChild(o)}})),r.submit()}function S(){try{return self!==top&&parent!==self}catch(e){return!0}}function w(){try{return self===top&&!!opener&&opener!==self&&!!window.name}catch(e){return!1}}function E(e){"completeAuth"==e.data.type&&e.origin===new URL(self.location.href).origin&&(window.removeEventListener("message",E),window.location.href=e.data.url)}function O(e){return x.apply(this,arguments)}function x(){return(x=Object(o.a)(a.a.mark((function e(t){var n,r,o,d,p,f,h,m,v,g,b,k,y,E,O,x,T,C,I;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.getUrl(),d=t.getStorage(),p=o.searchParams,f=p.get("state"),h=p.get("code"),m=p.get("error"),v=p.get("error_description"),f){e.next=11;break}return e.next=10,d.get(c.SMART_KEY);case 10:f=e.sent;case 11:if(!m&&!v){e.next=13;break}throw new Error([m,v].filter(Boolean).join(": "));case 13:if(u("key: %s, code: %s",f,h),f){e.next=16;break}throw new Error("No 'state' parameter found. Please (re)launch the app.");case 16:return e.next=18,d.get(f);case 18:if(g=e.sent,b=!l()||i.getPath(t,"options.fullSessionStorageSupport"),!l()||!g||g.completeInTarget){e.next=29;break}if(k=S(),y=w(),!k&&!y||o.searchParams.get("complete")){e.next=29;break}return o.searchParams.set("complete","1"),E=o.href,O=o.origin,k&&parent.postMessage({type:"completeAuth",url:E},O),y&&(opener.postMessage({type:"completeAuth",url:E},O),window.close()),e.abrupt("return",new Promise((function(){})));case 29:if(o.searchParams.delete("complete"),x=p.has("state"),l()&&i.getPath(t,"options.replaceBrowserHistory")&&(h||x)&&(h&&(p.delete("code"),u("Removed code parameter from the url.")),x&&b&&(p.delete("state"),u("Removed state parameter from the url.")),window.history.replaceState&&window.history.replaceState({},"",o.href)),g){e.next=34;break}throw new Error("No state found! Please (re)launch the app.");case 34:if(!h||(null===(n=g.tokenResponse)||void 0===n?void 0:n.access_token)||!g.tokenUri){e.next=54;break}if(h){e.next=38;break}throw new Error("'code' url parameter is required");case 38:return u("Preparing to exchange the code for access token..."),T=R(t,h,g),u("Token request options: %O",T),e.next=43,i.request(g.tokenUri,T);case 43:if(C=e.sent,u("Token response: %O",C),C.access_token){e.next=47;break}throw new Error("Failed to obtain access token.");case 47:return g.expiresAt=i.getAccessTokenExpiration(C,t),g=Object.assign(Object.assign({},g),{tokenResponse:C}),e.next=51,d.set(f,g);case 51:u("Authorization successful!"),e.next=55;break;case 54:u((null===(r=g.tokenResponse)||void 0===r?void 0:r.access_token)?"Already authorized":"No authorization needed");case 55:if(!b){e.next=58;break}return e.next=58,d.set(c.SMART_KEY,f);case 58:return I=new s.default(t,g),u("Created client instance: %O",I),e.abrupt("return",I);case 61:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,n){var r=n.redirectUri,a=n.clientSecret,o=n.tokenUri,i=n.clientId,s=n.codeVerifier;if(!r)throw new Error("Missing state.redirectUri");if(!o)throw new Error("Missing state.tokenUri");if(!i)throw new Error("Missing state.clientId");var c={method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:"code=".concat(t,"&grant_type=authorization_code&redirect_uri=").concat(encodeURIComponent(r))};return a?(c.headers.Authorization="Basic "+e.btoa(i+":"+a),u("Using state.clientSecret to construct the authorization header: %s",c.headers.Authorization)):(u("No clientSecret found in state. Adding the clientId to the POST body"),c.body+="&client_id=".concat(encodeURIComponent(i))),s&&(u("Found state.codeVerifier, adding to the POST body"),c.body+="&code_verifier=".concat(s)),c}function T(e,t,n){return C.apply(this,arguments)}function C(){return(C=Object(o.a)(a.a.mark((function e(t,n,r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O(t),n&&(o=o.then(n)),r&&(o=o.catch(r)),e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return _.apply(this,arguments)}function _(){return(_=Object(o.a)(a.a.mark((function e(t,n){var r,o,i,u,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getUrl(),o=r.searchParams.get("code"),i=r.searchParams.get("state"),!o||!i){e.next=5;break}return e.abrupt("return",O(t));case 5:if(u=t.getStorage(),e.t0=i,e.t0){e.next=11;break}return e.next=10,u.get(c.SMART_KEY);case 10:e.t0=e.sent;case 11:return l=e.t0,e.next=14,u.get(l);case 14:if(!(d=e.sent)){e.next=17;break}return e.abrupt("return",new s.default(t,d));case 17:return e.abrupt("return",b(t,n).then((function(){return new Promise((function(){}))})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}.call(this,n(27))},299:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var r=n(19),a=n(20),o=n(77),i=n(79),s=n(80),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Error",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(r.a)(this,n),(e=t.call(this,a)).message=a,e.name="HttpError",e.statusCode=o,e.status=o,e.statusText=i,e.body=s,e}return Object(a.a)(n,[{key:"toJSON",value:function(){return{name:this.name,statusCode:this.statusCode,status:this.status,statusText:this.statusText,message:this.message,body:this.body}}}]),n}(Object(s.a)(Error))},336:function(e,t,n){"use strict";n.r(t),t.default={expired:"Session expired! Please re-launch the app",noScopeForId:"Trying to get the ID of the selected %s. Please add 'launch' or 'launch/%s' to the requested scopes and try again.",noIfNoAuth:"You are trying to get %s but the app is not authorized yet.",noFreeContext:"Please don't use open fhir servers if you need to access launch context items like the %S."}},337:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var r=n(7),a=n.n(r),o=n(11),i=n(19),s=n(20),c=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,[{key:"get",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=sessionStorage[t])){e.next=3;break}return e.abrupt("return",JSON.parse(n));case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sessionStorage[t]=JSON.stringify(n),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unset",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in sessionStorage)){e.next=3;break}return delete sessionStorage[t],e.abrupt("return",!0);case 3:return e.abrupt("return",!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},456:function(e,t){},700:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),i=n.n(o),s=(n(266),n(267),n(268),n(269),n(270),n(271),n(7)),c=n.n(s),u=n(11),l=n(8),d=n(3),p=n(9);function f(e){return a.a.createElement(d.Navbar,{className:d.Classes.DARK},a.a.createElement(d.NavbarGroup,{align:d.Alignment.LEFT},a.a.createElement("img",{src:"smart-logo.png",alt:"SMART Logo",className:"nav-logo"}),a.a.createElement(d.NavbarHeading,null,"SMART Granular Scopes - September 2020 Connectathon")),a.a.createElement(d.NavbarGroup,{align:d.Alignment.RIGHT},a.a.createElement(d.Button,{onClick:function(){return e.toggleSettingsVisible()},icon:p.a.COG,large:!0})))}var h=n(19),m=n(20),v=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"checkLocalStorageAvailable",value:function(){var e=null;try{e=window.localStorage;var t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&e&&0!==e.length}}}]),e}();v.isLocalStorageAvailable=!0===v.checkLocalStorageAvailable();var g=n(117),b=n(77),k=n(79),y=n(80),S=function(e){Object(b.a)(n,e);var t=Object(k.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"getScopes",value:function(){var e="";return this.forEach((function(t,n){!1!==t&&(""===e?e=n:e+=" "+n)})),e}},{key:"buildScopeString",value:function(e,t,n,r,a){if(0===this.size)return"";var o=null!==e&&void 0!==e?e:"",i=!0;return this.forEach((function(e,n){r&&!e||a&&e||(i?i=!1:o+=null!==t&&void 0!==t?t:" ",o+=n)})),o+=null!==n&&void 0!==n?n:""}},{key:"save",value:function(e){sessionStorage.setItem(e,JSON.stringify(Array.from(this.entries())))}},{key:"loadFromScopes",value:function(e,t){var n=new Map;e.split(" ").forEach((function(e){n.set(e,!0)}));var r,a=Object(g.a)(this.keys());try{for(a.s();!(r=a.n()).done;){var o=r.value;n.has(o)?this.set(o,!0):this.set(o,!1)}}catch(u){a.e(u)}finally{a.f()}if(t){var i,s=Object(g.a)(n.keys());try{for(s.s();!(i=s.n()).done;){var c=i.value;this.set(c,!0)}}catch(u){s.e(u)}finally{s.f()}}}},{key:"compareToGranted",value:function(e){var t=[],n=[];return this.forEach((function(r,a){r&&(-1===e.indexOf(a)?n.push(a):t.push(a))})),{granted:t,denied:n}}},{key:"getScopeGrants",value:function(e){var t=new n([]);return this.forEach((function(n,r){n&&(-1===e.indexOf(r)?t.set(r,!1):t.set(r,!0))})),t}}],[{key:"load",value:function(e){var t,r,a=null!==(t=sessionStorage.getItem(e))&&void 0!==t?t:"";return a?new n(null!==(r=JSON.parse(a))&&void 0!==r?r:[]):new n}}]),n}(Object(y.a)(Map)),w=new S([["openid",!0],["fhirUser",!0],["offline_access",!0],["online_access",!1],["smart/orchestrate_launch",!1],["profile",!0],["launch/patient",!0],["launch/encounter",!0],["patient/*.read",!1],["patient/*.write",!1],["patient/*.*",!0],["user/*.*",!0],["patient/Patient.read",!1],["patient/Observation.read",!1]]);function E(e){var t=Object(r.useState)(w),n=Object(l.a)(t,2),o=n[0],i=n[1];function s(t){var n=new S(o);n.set(t,!o.get(t)),n.save("smart-parameters-v1"),i(n),e.common.setRequestedScopes(n)}return Object(r.useEffect)((function(){var t=S.load("smart-parameters-v1");t.size>=w.size?(i(t),e.common.setRequestedScopes(t)):e.common.setRequestedScopes(w)}),[]),a.a.createElement(d.Card,{interactive:!1},a.a.createElement(d.FormGroup,{label:"Scopes",helperText:"Scopes based on SMART V1"},function(){var e=[],t=0;return o.forEach((function(n,r){switch(r){case"patient/Patient.read":case"patient/*.read":case"launch/patient":e.push(a.a.createElement("br",{key:"br_".concat(t++)}))}r.length>25?e.push(a.a.createElement(d.Tooltip,{content:r},a.a.createElement(d.Checkbox,{key:r,className:"fixed-checkbox",label:r,inline:!0,checked:n,onClick:function(){return s(r)}}))):e.push(a.a.createElement(d.Checkbox,{key:r,className:"fixed-checkbox",label:r,inline:!0,checked:n,onClick:function(){return s(r)}}))})),e}()))}var O=new S([["openid",!0],["fhirUser",!0],["offline_access",!0],["online_access",!1],["smart/orchestrate_launch",!1],["profile",!0],["launch/patient",!0],["launch/encounter",!1],["patient/Observation.r",!1],["patient/Observation.rs",!0],["patient/Observation.crs",!1],["patient/Observation.rs?category=vital-signs",!1],["patient/Observation.rs?category=laboratory",!1],["patient/Observation.rs?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs",!1],["patient/Observation.crs?category=vital-signs",!1],["patient/Observation.rs?_security=L",!1],["patient/Observation.rs?_security=http://terminology.hl7.org/CodeSystem/v3-Confidentiality|L",!1],["patient/Observation.rs?_security=N",!1],["patient/Observation.rs?_security=R",!1],["patient/Observation.rs?_security=V",!1],["patient/Observation.rs?_security=L,N",!1],["patient/Observation.rs?_security=L,N,R",!1],["patient/Observation.rs?_security=L,N,R,V",!1],["patient/Observation.rs?category=vital-signs&_security=L",!1],["patient/Observation.read",!1]]);function x(e){var t=Object(r.useRef)(!0),n=Object(r.useState)(O),o=Object(l.a)(n,2),i=o[0],s=o[1];function c(t){var n=new S(i);n.set(t,!i.get(t)),n.save("smart-parameters-scenarios"),s(n),e.common.setRequestedScopes(n)}return Object(r.useEffect)((function(){if(t.current){var n=S.load("smart-parameters-scenarios");n.size>=O.size?(s(n),e.common.setRequestedScopes(n)):e.common.setRequestedScopes(O),t.current=!1}}),[i,s]),a.a.createElement(d.Card,{interactive:!1},a.a.createElement(d.FormGroup,{label:"Scopes",helperText:"Scopes based on Connectathon Scenarios"},function(){var e=[],t=0;return i.forEach((function(n,r){switch(r){case"patient/Observation.read":case"patient/Observation.rs?category=vital-signs&_security=L":case"patient/Observation.r":case"patient/Observation.rs?category=vital-signs":case"patient/Observation.rs?_security=L":case"launch/patient":e.push(a.a.createElement("br",{key:"br_".concat(t++)}))}r.length>25?e.push(a.a.createElement(d.Tooltip,{content:r},a.a.createElement(d.Checkbox,{key:r,className:"fixed-checkbox",label:r,inline:!0,checked:n,onClick:function(){return c(r)}}))):e.push(a.a.createElement(d.Checkbox,{key:r,className:"fixed-checkbox",label:r,inline:!0,checked:n,onClick:function(){return c(r)}}))})),e}()))}function R(e){var t=Object(r.useRef)(!0),n=Object(r.useState)(""),o=Object(l.a)(n,2),i=o[0],s=o[1];return Object(r.useEffect)((function(){var e;t.current&&(s(null!==(e=sessionStorage.getItem("standalone-selected-tab-id"))&&void 0!==e?e:"parameter-tab-v1"),t.current=!1)}),[]),a.a.createElement(d.Card,{interactive:!1,elevation:d.Elevation.ONE},a.a.createElement(d.H5,null,"Standalone Launch"),a.a.createElement(d.FormGroup,{label:"FHIR Server",helperText:"Base URL for FHIR Server to connect to",labelFor:"input-aud"},a.a.createElement(d.InputGroup,{id:"input-aud",value:e.common.aud,onChange:function(t){e.common.setAud(t.target.value)}})),a.a.createElement(d.FormGroup,{label:"Client ID",helperText:"OAuth client ID",labelFor:"input-appId"},a.a.createElement(d.InputGroup,{id:"input-appId",value:e.common.appId,onChange:function(t){e.common.setAppId(t.target.value)}})),a.a.createElement(d.Tooltip,{content:"Use PKCE"},a.a.createElement(d.Checkbox,{key:"enable-pkce",className:"narrow-fixed-checkbox",label:"Use PKCE",inline:!0,checked:e.common.usePKCE,onClick:function(){return e.common.togglePKCE()}})),a.a.createElement(d.Tooltip,{content:"Use HTTP POST Auth workflow"},a.a.createElement(d.Checkbox,{key:"enable-post",className:"narrow-fixed-checkbox",label:"Use POST",inline:!0,checked:e.common.usePost,onClick:function(){return e.common.togglePost()}})),a.a.createElement(d.Divider,null),a.a.createElement(d.Tabs,{id:"standalone-parameter-tabs",animate:!0,vertical:!1,selectedTabId:i,onChange:function(e){s(e.toString()),sessionStorage.setItem("standalone-selected-tab-id",e.toString())}},a.a.createElement(d.H6,null,"Scopes:"),a.a.createElement(d.Tab,{id:"parameter-tab-v1",title:"SMART V1",panel:a.a.createElement(E,{common:e.common})}),a.a.createElement(d.Tab,{id:"parameter-tab-scenarios",title:"Scenarios",panel:a.a.createElement(x,{common:e.common})}),a.a.createElement(d.Tab,{id:"parameter-tab-playground",title:"Playground",panel:a.a.createElement(d.Card,null,"Coming soon...")})),a.a.createElement(d.Divider,null),a.a.createElement(d.Button,{key:"run-request",id:"run-request",text:"Launch Auth Redirect",onClick:function(){e.common.requestedScopes?e.common.startAuth():e.common.toaster("No Scopes Available!")}}),a.a.createElement(d.Tooltip,{content:"Refresh the existing token (does NOT change scopes)"},a.a.createElement(d.Button,{key:"refresh-request",id:"refresh-request",text:"Refresh Token",disabled:!1,onClick:function(){return e.common.refreshAuth()}})),a.a.createElement(d.Tooltip,{content:"Fetch the current .well-known/smart-configuration data"},a.a.createElement(d.Button,{key:"load-smart-config",id:"load-smart-config",text:"Get SMART Config",disabled:!1,onClick:function(){return e.common.loadSmartConfig()}})),a.a.createElement(d.Tooltip,{content:"Ask the server to perform token introspection"},a.a.createElement(d.Button,{key:"introspect-token",id:"introspect-token",text:"Introspect Token",disabled:!e.common.intropectionIsPossible,onClick:function(){return e.common.introspectToken()}})))}var T,C=n(118),I=n.n(C),_=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"copyToClipboard",value:function(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(n){return document.body.removeChild(t),!1}return document.body.removeChild(t),!0}}]),e}();!function(e){e[e.None=0]="None",e[e.FHIR=1]="FHIR",e[e.JSON=2]="JSON",e[e.Error=3]="Error",e[e.Text=4]="Text",e[e.Markdown=5]="Markdown",e[e.HTML=6]="HTML"}(T||(T={}));var j=n(706),P=n(704),A=n(705),U=n(214),N=n.n(U);function D(e){var t=Object(r.useState)(""),n=Object(l.a)(t,2),o=n[0],i=n[1],s=Object(r.useState)(""),c=Object(l.a)(s,2),u=c[0],f=c[1],h=void 0===e.selectedDataRowIndex||-1===e.selectedDataRowIndex?e.data?e.data.length-1:-1:e.selectedDataRowIndex;if(Object(r.useEffect)((function(){o===u&&""!==o||(e.data&&0!==e.data.length?(""!==o&&f(o),""===o&&(e.data[h].info?f("info"):e.data[h].responseData?f("response_data"):e.data[h].outcome?f("outcome"):e.data[h].requestData?f("request_data"):e.data[h].requestUrl&&f("request_url"))):f(""))}),[e.data,o,u,h]),!e.data||0===e.data.length)return null;function m(e){switch(e){case T.None:return p.a.MINUS;case T.FHIR:return p.a.FLAME;case T.JSON:return p.a.CODE;case T.Error:return p.a.ERROR;case T.Text:return p.a.ALIGN_LEFT;default:return p.a.INFO_SIGN}}function v(t,n,r,o,i){var s;switch(o){case T.Text:s="text";break;case T.Error:case T.FHIR:case T.JSON:s="json";break;case T.Markdown:s="markdown";break;case T.HTML:s="html";break;default:s="text"}return o===T.Markdown||o===T.HTML?a.a.createElement(d.Tab,{key:t,id:t,panel:a.a.createElement(N.a,{className:e.common.isUiDark?"code-md-tab-dark":"code-md-tab-light",source:r,escapeHtml:!1})},a.a.createElement(d.Icon,{icon:null!==i&&void 0!==i?i:p.a.INFO_SIGN})," ",n):a.a.createElement(d.Tab,{key:t,id:t,panel:a.a.createElement(j.a,{className:"code-tab",language:s,style:e.common.isUiDark?P.a:A.a},r)},a.a.createElement(d.Icon,{icon:null!==i&&void 0!==i?i:p.a.INFO_SIGN})," ",n)}function g(e){return e.replace(" ","_").toLowerCase()}return a.a.createElement(d.Tabs,{animate:!0,vertical:!0,selectedTabId:u,onChange:function(e){i(e.toString())}},a.a.createElement("div",null,a.a.createElement(d.Tooltip,{content:"Copy To Clipboard"},a.a.createElement(d.Button,{icon:p.a.DUPLICATE,minimal:!0,style:{marginLeft:5,marginRight:5,marginTop:10},onClick:function(){switch(u){case"request_url":return void e.common.copyToClipboard(e.data[h].requestUrl,"Request URL");case"request_data":return void e.common.copyToClipboard(e.data[h].requestData,"Request Data");case"response_data":return void e.common.copyToClipboard(e.data[h].responseData,"Response Data");case"info":return void e.common.copyToClipboard(e.data[h].info,"Info");case"outcome":return void e.common.copyToClipboard(e.data[h].outcome,"OperationOutcome")}e.data[h].extended&&e.data[h].extended.forEach((function(t,n){g(n)===u&&e.common.copyToClipboard(t)}))}})),void 0!==e.processRowDelete&&a.a.createElement(d.Tooltip,{content:"Delete"},a.a.createElement(d.Button,{icon:p.a.DELETE,minimal:!0,style:{marginLeft:5,marginRight:5,marginTop:10},onClick:function(){e.processRowDelete(h)}}))),void 0!==e.processRowToggle&&a.a.createElement("div",null,a.a.createElement(d.Switch,{disabled:e.busy,checked:e.data[h].enabled,label:"Enabled",onChange:function(){e.processRowToggle(h)}})),void 0!==e.tabButtonText&&void 0!==e.tabButtonHandler&&a.a.createElement("div",null,a.a.createElement(d.Button,{disabled:e.busy,text:e.tabButtonText,onClick:function(){e.tabButtonHandler(h)}})),function(){var t,n,r,a,o,i=[];return e.data[h].requestUrl&&i.push(v("request_url","Request URL",e.data[h].requestUrl,T.Text,p.a.GLOBE_NETWORK)),e.data[h].requestData&&i.push(v("request_data","Request Data",e.data[h].requestData,null!==(t=e.data[h].requestDataType)&&void 0!==t?t:T.JSON,m(null!==(n=e.data[h].requestDataType)&&void 0!==n?n:T.JSON))),e.data[h].outcome&&i.push(v("outcome","Outcome",e.data[h].outcome,T.FHIR,p.a.FLAME)),e.data[h].responseData&&i.push(v("response_data","Response Data",e.data[h].responseData,null!==(r=e.data[h].responseDataType)&&void 0!==r?r:T.Text,m(null!==(a=e.data[h].responseDataType)&&void 0!==a?a:T.Text))),e.data[h].info&&i.push(v("info","Info",e.data[h].info,null!==(o=e.data[h].infoDataType)&&void 0!==o?o:T.JSON,p.a.INFO_SIGN)),e.data[h].extended&&e.data[h].extended.forEach((function(t,n){var r,a=g(n);i.push(v(a,n,t,null!==(r=e.data[h].extendedDataType)&&void 0!==r?r:T.Text,m(e.data[h].extendedDataType)))})),i}())}function q(e){var t=r.useState(!0),n=Object(l.a)(t,2),a=n[0],o=n[1],i=r.useState(-1),s=Object(l.a)(i,2),c=s[0],u=s[1];return r.createElement(d.Card,{key:e.info.id},r.createElement(d.Button,{onClick:function(){o(!a)},minimal:!0,style:{float:"right"},icon:a?p.a.CHEVRON_DOWN:p.a.CHEVRON_RIGHT}),r.createElement("div",{style:{float:"left",width:"20px",marginLeft:"5px",marginRight:"10px"}},e.status.busy?r.createElement(d.Spinner,{size:d.Spinner.SIZE_SMALL}):e.info.stepNumber?e.status.complete?r.createElement(d.Icon,{icon:p.a.TICK,intent:d.Intent.SUCCESS,iconSize:d.Icon.SIZE_LARGE}):e.status.available?r.createElement(d.Icon,{icon:p.a.ARROW_RIGHT,intent:d.Intent.PRIMARY,iconSize:d.Icon.SIZE_LARGE}):r.createElement(d.Icon,{icon:p.a.DISABLE,intent:d.Intent.WARNING,iconSize:d.Icon.SIZE_STANDARD}):r.createElement(d.Icon,{icon:p.a.MINUS,iconSize:d.Icon.SIZE_LARGE})),r.createElement(d.H5,null,e.info.optional?"(Optional) ":"",e.info.heading,a&&e.data.length>1&&r.createElement(d.HTMLSelect,{id:"index-selector",value:c,onChange:function(e){u(parseInt(e.currentTarget.value))},style:{margin:5}},r.createElement("option",{value:-1},"Latest"),e.data.map((function(e,t){return r.createElement("option",{key:t,value:t},e.name)})))),a&&r.createElement("div",null,""!==e.info.description&&r.createElement(d.H6,null,e.info.description),!0!==e.renderChildrenAfter&&void 0!==e.children&&e.children,(!0===e.renderChildrenAfter||void 0!==e.children)&&r.createElement("br",null),r.createElement(D,{common:e.common,data:e.data,busy:e.status.busy,selectedDataRowIndex:c,processRowDelete:e.processRowDelete,processRowToggle:e.processRowToggle,tabButtonText:e.tabButtonText,tabButtonHandler:e.tabButtonHandler}),!0===e.renderChildrenAfter&&void 0!==e.children&&r.createElement(r.Fragment,null,r.createElement("br",null),e.children)))}var L=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"decodeToken",value:function(e){return String(e||"").split(".").map((function(e){try{return JSON.parse(atob(e))}catch(t){return e}}))}},{key:"getDecodedTokenString",value:function(t){return t?e.decodeToken(t).map((function(e){return JSON.stringify(e,null,2)})).join("\n.\n"):"No Token Found"}}]),e}(),M={available:!0,complete:!1,busy:!1},F={available:!0,complete:!1,busy:!0};function z(e){var t=Object(r.useState)(void 0),n=Object(l.a)(t,2),o=n[0],i=n[1],s=Object(r.useState)([]),p=Object(l.a)(s,2),f=p[0],h=p[1],m=Object(r.useState)(M),v=Object(l.a)(m,2),g=v[0],b=v[1],k=Object(r.useState)(void 0),y=Object(l.a)(k,2),w=y[0],E=y[1];function O(t){var n=0,r="";return e.common.patientId&&(r=x(r,n++,"patient","Patient/".concat(e.common.patientId))),t?(t.forEach((function(t,a){if(t&&-1!==a.indexOf("/".concat(e.resourceName,"."))){var o=a.indexOf("?");if(-1!==o)a.substr(o+1).split("&").forEach((function(e){var t=e.split("=");2===t.length&&(r=x(r,n++,t[0],t[1]))}))}})),r):r}function x(e,t,n,r){return 0===t?e+"?".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r)):e+"&".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r))}function R(t){b(F),t||(t=w),e.resourceName&&e.id?function(e,t,n){_.apply(this,arguments)}(t,e.resourceName,e.id):e.resourceName&&function(e,t){I.apply(this,arguments)}(t,e.resourceName)}function C(e){return e.resourceType&&"Bundle"===e.resourceType?void 0!==e.total?"".concat(e.total):e.entry?"".concat(e.entry.length,"+..."):"":""}function I(){return(I=Object(u.a)(c.a.mark((function t(n,r){var a,o,i,s,u,l,d,p,m,v,g,k,y,S;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.common.getFhirClient()){t.next=4;break}return console.log("No client"),t.abrupt("return");case 4:return o=new Date,i=0===f.length?"Initial query: ".concat(o.toLocaleTimeString()):"Query #".concat(f.length,": ").concat(o.toLocaleTimeString()),s=O(n),u="".concat(r,"/").concat(s),t.prev=8,t.next=11,a.request(u);case 11:l=t.sent,d={name:i,id:"request-".concat(f.length),requestUrl:"".concat(a.state.serverUrl,"/").concat(u),responseData:JSON.stringify(l,null,2),responseDataType:T.FHIR},p="",s&&(p=s.substr(1),m=p.split("&"),p="  | Parameter | Value |\n  |-----------|-------|\n",v=[],m.forEach((function(e){var t=e.split("=");2===t.length&&v.push("  |".concat(t[0],"|`").concat(decodeURIComponent(t[1]).replace("|","\\|"),"`|"))})),v.sort(),p+=v.join("\n")),g="* Processed at: `".concat(o.toLocaleString(),"`\n")+"* Items returned: `".concat(C(l),"`\n")+"\n".concat(p,"\n"),d.info=g,d.infoDataType=T.Markdown,(k=f.slice()).push(d),h(k),t.next=29;break;case 23:t.prev=23,t.t0=t.catch(8),y={name:i,id:"request-".concat(f.length),requestUrl:"".concat(a.state.serverUrl,"/").concat(u),responseData:JSON.stringify(t.t0,null,2),responseDataType:T.Error},(S=f.slice()).push(y),h(S);case 29:b(M);case 30:case"end":return t.stop()}}),t,null,[[8,23]])})))).apply(this,arguments)}function _(){return(_=Object(u.a)(c.a.mark((function t(n,r,a){var o,i,s,u,l,d,p,m;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.common.getFhirClient()){t.next=4;break}return console.log("No client"),t.abrupt("return");case 4:return i=new Date,s=0===f.length?"Initial query: ".concat(i.toLocaleTimeString()):"Query #".concat(f.length,": ").concat(i.toLocaleTimeString()),t.prev=6,t.next=9,o.request("".concat(r,"/").concat(a));case 9:u=t.sent,l={name:s,id:"request-".concat(f.length),requestUrl:"".concat(o.state.serverUrl,"/").concat(r,"/").concat(a),responseData:JSON.stringify(u,null,2),responseDataType:T.FHIR,info:"* Processed at: `".concat(i.toLocaleString(),"`\n")+"* `".concat(r,"/").concat(a,"`\n"),infoDataType:T.Markdown},(d=f.slice()).push(l),h(d),t.next=22;break;case 16:t.prev=16,t.t0=t.catch(6),p={name:s,id:"request-".concat(f.length),requestUrl:"".concat(o.state.serverUrl,"/").concat(r,"/").concat(a),responseData:JSON.stringify(t.t0,null,2),responseDataType:T.Error},(m=f.slice()).push(p),h(m);case 22:b(M);case 23:case"end":return t.stop()}}),t,null,[[6,16]])})))).apply(this,arguments)}function j(e){var t=new S(w);t.set(e,!w.get(e)),E(t)}return Object(r.useEffect)((function(){E(e.common.requestedScopes)}),[e.common.requestedScopes]),Object(r.useEffect)((function(){R(e.common.requestedScopes)}),[]),Object(r.useEffect)((function(){if(void 0===o){var t={id:"resrouce-card-"+e.resourceName,heading:e.title,description:"",optional:!1};i(t)}}),[e.title,e.resourceName,o]),void 0===o?a.a.createElement("div",null):a.a.createElement(q,{key:"resource-card-"+e.resourceName,info:o,data:f,status:g,common:e.common,tabButtonText:e.id?"Load":"Search",tabButtonHandler:function(){return R(void 0)}},function(){if(void 0===w)return[];var t=[],n=[];return w.forEach((function(r,o){if(-1!==o.indexOf("/".concat(e.resourceName,"."))){var i=o.indexOf("?");if(-1!==i){var s=o.substr(i+1);t.push(s),s.length>25?n.push(a.a.createElement(d.Tooltip,{key:"tt_".concat(o),content:s},a.a.createElement(d.Checkbox,{key:o,className:"fixed-checkbox",label:s,inline:!0,checked:r,onClick:function(){return j(o)}}))):n.push(a.a.createElement(d.Checkbox,{key:o,className:"fixed-checkbox",label:s,inline:!0,checked:r,onClick:function(){return j(o)}}))}}})),n.length>0&&n.push(a.a.createElement(d.Divider,{key:"di_"+n.length})),n}())}var H={available:!0,complete:!1,busy:!1},B=void 0,J=void 0;function G(){var e=a.a.createRef(),t=Object(r.useRef)(null),n=Object(r.useState)(!1),o=Object(l.a)(n,2),i=o[0],s=o[1],h=Object(r.useState)(!1),m=Object(l.a)(h,2),g=m[0],b=m[1],k=Object(r.useState)(-1),y=Object(l.a)(k,2),w=y[0],E=y[1],O=Object(r.useState)("smart_granular_app"),x=Object(l.a)(O,2),C=x[0],j=x[1],P=Object(r.useState)(""),A=Object(l.a)(P,2),U=A[0],N=A[1],D=Object(r.useState)(new S),M=Object(l.a)(D,2),F=M[0],G=M[1],K=Object(r.useState)(""),V=Object(l.a)(K,2),W=V[0],Y=V[1],$=Object(r.useState)(""),Q=Object(l.a)($,2),Z=Q[0],X=Q[1],ee=Object(r.useState)(""),te=Object(l.a)(ee,2),ne=te[0],re=te[1],ae=Object(r.useState)(!1),oe=Object(l.a)(ae,2),ie=oe[0],se=oe[1],ce=Object(r.useState)([]),ue=Object(l.a)(ce,2),le=ue[0],de=ue[1],pe=Object(r.useState)(!0),fe=Object(l.a)(pe,2),he=fe[0],me=fe[1],ve=Object(r.useState)(!0),ge=Object(l.a)(ve,2),be=ge[0],ke=ge[1],ye=Object(r.useState)([]),Se=Object(l.a)(ye,2),we=Se[0],Ee=Se[1],Oe=Object(r.useState)([]),xe=Object(l.a)(Oe,2),Re=xe[0],Te=xe[1],Ce=Object(r.useState)(!1),Ie=Object(l.a)(Ce,2),_e=Ie[0],je=Ie[1],Pe=Object(r.useState)(""),Ae=Object(l.a)(Pe,2),Ue=Ae[0],Ne=Ae[1],De=Object(r.useState)([]),qe=Object(l.a)(De,2),Le=qe[0],Me=qe[1];function Fe(){b(!g)}function ze(e,t,n,r){if(e.searchParams.has(t)){var a,o=null!==(a=e.searchParams.get(t))&&void 0!==a?a:"";return r&&sessionStorage.setItem(t,o),n&&n(o),o}var i=sessionStorage.getItem(t);if(i)return n&&n(i),i}function He(e,n,r,a){(function(){if(!t.current){var e={autoFocus:!1,canEscapeKeyClear:!0,position:d.Position.TOP};t.current=d.Toaster.create(e,document.body)}return t.current})().show({message:e,icon:n,timeout:r,intent:a})}function Be(e,t){var n=_.copyToClipboard(e);n&&t&&He("".concat(t," Copied!"),p.a.CLIPBOARD,500),!n&&t&&He("Failed to copy!",p.a.WARNING_SIGN,1e3)}function Je(){J=setTimeout(Je,1e4);var e=(new Date).getTime();w<e||e+1e4>w&&He("Auth token will timeout in ".concat((w-e)/1e3," seconds"),p.a.TIME,2e3,d.Intent.WARNING)}function Ge(){return Ke.apply(this,arguments)}function Ke(){return(Ke=Object(u.a)(c.a.mark((function e(){var t,n,r,a,o,i,s,u,l,d,f,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U){e.next=3;break}return He("A FHIR Server is required to fetch SMART Configuration",p.a.ERROR),e.abrupt("return");case 3:return t=new Date,n=U.endsWith("/")?"".concat(U,".well-known/smart-configuration"):"".concat(U,"/.well-known/smart-configuration"),e.prev=5,(r=new Headers).append("Accept","application/json"),e.next=10,fetch(n,{method:"GET",headers:r});case 10:return a=e.sent,e.next=13,a.text();case 13:o=e.sent,i=JSON.parse(o),s=[],u={id:"smart-".concat(le.length),name:"SMART Config Load #".concat(le.length),requestUrl:n,responseData:JSON.stringify(i,null,2),responseDataType:T.JSON},l="* Processed at: `".concat(t.toLocaleString(),"`\n\n"),l+="  | Endpoint | URL |\n  |-------|-------|\n"+"  | Authorization | ".concat(i.authorization_endpoint," |\n")+"  | Introspection | ".concat(i.introspection_endpoint," |\n")+"  | Management | ".concat(i.management_endpoint," |\n")+"  | Revocation | ".concat(i.revocation_endpoint," |\n")+"  | Token | ".concat(i.token_endpoint," |\n")+"\n",s=[],i.code_challenge_methods_supported.length>0&&(i.code_challenge_methods_supported.forEach((function(e){s.push("  * `".concat(e,"`"))})),s.sort(),l+="* Code Challenge Methods Supported\n",l+=s.join("\n"),l+="\n\n\n"),s=[],i.capabilities.length>0&&(i.capabilities.forEach((function(e){s.push("  * `".concat(e,"`"))})),s.sort(),l+="* Capabilities\n",l+=s.join("\n"),l+="\n\n\n"),s=[],i.scopes_supported.length>0&&(i.scopes_supported.forEach((function(e){s.push("  * `".concat(e,"`"))})),s.sort(),l+="* Scopes Supported\n",l+=s.join("\n"),l+="\n\n\n"),s=[],i.response_types_supported.length>0&&(i.response_types_supported.forEach((function(e){s.push("  * `".concat(e,"`"))})),s.sort(),l+="* Response Types Supported\n",l+=s.join("\n"),l+="\n\n\n"),u.info=l,u.infoDataType=T.Markdown,(d=le.slice()).push(u),de(d),e.next=40;break;case 34:e.prev=34,e.t0=e.catch(5),f={id:"smart-".concat(le.length),name:"SMART Config Load #".concat(le.length),requestUrl:n,responseData:JSON.stringify(e.t0,null,2),responseDataType:T.Error},(h=le.slice()).push(f),de(h);case 40:case"end":return e.stop()}}),e,null,[[5,34]])})))).apply(this,arguments)}function Ve(){v.isLocalStorageAvailable?localStorage.setItem("usePKCE",(!he).toString()):sessionStorage.setItem("usePKCE",(!he).toString()),me(!he)}function We(){v.isLocalStorageAvailable?localStorage.setItem("usePost",(!be).toString()):sessionStorage.setItem("usePost",(!be).toString()),ke(!be)}function Ye(){return $e.apply(this,arguments)}function $e(){return($e=Object(u.a)(c.a.mark((function e(){var t,n,r,a,o,i,s,u,l,d,f,h,m,v,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ie){e.next=3;break}return He("Introspection is currently NOT available",p.a.ERROR),e.abrupt("return");case 3:return a=(null===(t=B)||void 0===t?void 0:t.state.introspectionUri)||"",o=encodeURIComponent("token")+"="+encodeURIComponent((null===(n=B)||void 0===n||null===(r=n.state.tokenResponse)||void 0===r?void 0:r.access_token)||""),e.prev=5,(u=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u.append("Authorization","Bearer ".concat(null===(i=B)||void 0===i||null===(s=i.state.tokenResponse)||void 0===s?void 0:s.access_token)),e.next=11,fetch(a,{method:"POST",headers:u,body:o});case 11:return l=e.sent,e.next=14,l.text();case 14:d=e.sent,f=JSON.parse(d),h={id:"introspection-".concat(Re.length),name:"Token Introspection #".concat(Re.length),requestUrl:a,requestData:o,requestDataType:T.Text,responseData:JSON.stringify(f,null,2),responseDataType:T.JSON},(m=Re.slice()).push(h),Te(m),e.next=28;break;case 22:e.prev=22,e.t0=e.catch(5),v={id:"introspection-".concat(Re.length),name:"Token Introspection #".concat(Re.length),requestUrl:a,requestData:o,requestDataType:T.Text,responseData:JSON.stringify(e.t0,null,2),responseDataType:T.Error},(g=Re.slice()).push(v),Te(g);case 28:case"end":return e.stop()}}),e,null,[[5,22]])})))).apply(this,arguments)}function Qe(){if(U){var e=F.getScopes();I.a.oauth2.authorize({client_id:C,scope:e,iss:U,redirect_uri:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_REDIRECT_URL||void 0,usePKCE:he,usePost:be})}else He("Standalone launch requires an Audience!",p.a.ERROR)}function Ze(){var e,t,n;if(B){var r=null!==(e=null===(t=B)||void 0===t||null===(n=t.state.tokenResponse)||void 0===n?void 0:n.refresh_token)&&void 0!==e?e:"";B.refresh().then((function(e){var t;et(!0,r,T.Text,!1,F.getScopeGrants(null!==(t=B.state.scope)&&void 0!==t?t:""))})).catch((function(e){Xe(!0,e)}))}else He("Refreshing requires an authorication token!",p.a.ERROR,void 0,d.Intent.DANGER)}function Xe(e,t){var n,r,a,o,i,s,c,u,l=new Date;(e?(a="refresh_".concat(we.length),o="Token Refresh #".concat(we.length," - ").concat(l.toLocaleTimeString())):(a="initial_auth",o="SMART Launch - ".concat(l.toLocaleString())),(null===(n=B)||void 0===n?void 0:n.state)&&(null===(r=B)||void 0===r?void 0:r.state.authorizeUri))?i=null===(s=B)||void 0===s?void 0:s.state.authorizeUri:i=null!==(c=null===(u=B)||void 0===u?void 0:u.state.serverUrl.replace(/fhir$/,"auth/token"))&&void 0!==c?c:U;var f={id:a,name:o,requestUrl:i+"\n<<< "+l.toLocaleString(),responseData:JSON.stringify(t,null,2),responseDataType:T.Error},h=S.load("requestedScopes");if(h.size>0&&(f.requestData=h.getScopes().split(" ").join("\n"),f.requestDataType=T.Markdown),e){var m=we.slice();m.push(f),Ee(m),He("Token renewal failed!",p.a.ERROR,void 0,d.Intent.DANGER)}else Ee([f]),He("Authorization failed!",p.a.ERROR,void 0,d.Intent.DANGER)}function et(e,t,n,r,a){var o,i,s,c,u,l,d,p,f,h,m,v,g=new Date,b=null!==(o=null===(i=B)||void 0===i||null===(s=i.state.tokenResponse)||void 0===s?void 0:s.expires_in)&&void 0!==o?o:-1;b<0?E(-1):(E(g.getTime()+b),J&&(window.clearTimeout(J),J=void 0),J=setTimeout(Je,1e4)),e?(m="refresh_".concat(we.length),v="Token Refresh #".concat(we.length," - ").concat(g.toLocaleTimeString())):(m="initial_auth",v="SMART Launch - ".concat(g.toLocaleString()));var k=new Map([["ID Token",L.getDecodedTokenString(null===(c=B)||void 0===c||null===(u=c.state.tokenResponse)||void 0===u?void 0:u.id_token)],["Refresh Token",null!==(l=null===(d=B)||void 0===d||null===(p=d.state.tokenResponse)||void 0===p?void 0:p.refresh_token)&&void 0!==l?l:""]]),y={id:m,name:v,requestUrl:null!==(f=null===(h=B)||void 0===h?void 0:h.state.serverUrl.replace(/fhir$/,"auth/token"))&&void 0!==f?f:U,responseData:JSON.stringify(B.state.tokenResponse,null,2),responseDataType:T.JSON,extended:k,extendedDataType:T.JSON};if(a){var S="* Processed at: `".concat(g.toLocaleString(),"`\n")+"\n  | Scope | State |\n  |-------|-------|\n",w=[];a.forEach((function(e,t){w.push("|".concat(t.replace("|","\\|"),"|").concat(e?"Accepted":"Denied","|"))})),w.sort(),S+=w.join("\n"),y.info=S,y.infoDataType=T.Markdown}else y.info="Processed at: `".concat(g.toLocaleString(),"`"),y.infoDataType=T.Text;t&&(y.requestData=r?JSON.stringify(t,null,2):t,y.requestDataType=null!==n&&void 0!==n?n:T.Text);var O=we.slice();if(O.push(y),Ee(O),e){var x=we.slice();x.push(y),Ee(x)}else Ee([y])}function tt(e){var t,n,r,a,o,i;console.log("SMART Ready:",e),(B=e).state.introspectionUri&&(null===(t=B.state.tokenResponse)||void 0===t?void 0:t.access_token)&&se(!0);var s=null!==(n=sessionStorage.getItem("aud"))&&void 0!==n?n:"",c=S.load("requestedScopes");G(c);var u=c.getScopeGrants(null!==(r=B.state.scope)&&void 0!==r?r:""),l=L.decodeToken(null!==(a=null===(o=B.state.tokenResponse)||void 0===o?void 0:o.id_token)&&void 0!==a?a:"");3===l.length&&(l[1].profile?Y(l[1].profile):Y(""),l[1].fhirUser?X(l[1].fhirUser):X(""));var d=function(){if(!B)return"";if(B.patient.id)return B.patient.id;if(W&&W.startsWith("Patient/"))return W.substr(8);if(Z&&Z.startsWith("Patient/"))return Z.substr(8);return""}();re(d);var p=!1,f=[];c.forEach((function(t,n){var r;if(n&&t)switch(n){case"openid":case"fhirUser":case"offline_access":case"online_access":case"smart/orchestrate_launch":case"profile":break;case"launch/patient":case"patient/*.read":case"patient/*.write":case"patient/*.*":-1===f.indexOf("Patient")&&f.push("Patient");break;case"launch/encounter":-1===f.indexOf("Encounter")&&f.push("Encounter");break;case"user/*.*":p=!0,-1===f.indexOf("Patient")&&f.push("Patient"),-1===f.indexOf("Encounter")&&f.push("Encounter"),Ne(null!==(r=e.user.resourceType)&&void 0!==r?r:"");break;default:var a=n.split("/")[1].split(/[.?]/);-1===f.indexOf(a[0])&&f.push(a[0])}})),je(p),Me(f);var h=null!==(i=c.buildScopeString("`","`<br/>`","`",!0,!1))&&void 0!==i?i:"`NONE`";et(!1,"| Name | Value |\n|-------|-------|\n"+"|client id|".concat(C,"|\n")+"|scopes|".concat(h,"|\n")+"|aud|".concat(s,"|\n")+"|PKCE:Challenge|".concat(e.state.codeChallenge,"|\n")+"|PKCE:Verifier|".concat(e.state.codeVerifier,"|\n"),T.Markdown,!1,u)}function nt(e){Xe(!1,e)}function rt(e){sessionStorage.setItem("aud",e),N(e)}function at(e){sessionStorage.setItem("appId",e),j(e)}function ot(e){e.save("requestedScopes"),G(e)}function it(){return B}Object(r.useEffect)((function(){("true"===localStorage.getItem("uiDark")||"true"===sessionStorage.getItem("uiDark"))&&s(!0),("false"===localStorage.getItem("usePKCE")||"false"===sessionStorage.getItem("usePKCE"))&&me(!1),("false"===localStorage.getItem("usePost")||"false"===sessionStorage.getItem("usePost"))&&ke(!1);var e=new URL(window.location.href);ze(e,"aud",N,!0),ze(e,"appId",j,!0),ze(e,"code")&&I.a.oauth2.ready(tt,nt)}),[]),Object(r.useEffect)((function(){if(e){if(i)return"bp3-dark"!==e.current.className&&(e.current.className="bp3-dark"),"body-dark"!==document.body.className&&(document.body.className="body-dark"),void(v.isLocalStorageAvailable?localStorage.setItem("uiDark",i.toString()):sessionStorage.setItem("uiDark",i.toString()));"bp3-dark"===e.current.className&&(e.current.className=""),"body-dark"===document.body.className&&(document.body.className=""),v.isLocalStorageAvailable?localStorage.setItem("uiDark",i.toString()):sessionStorage.setItem("uiDark",i.toString())}}),[i,e]);var st={isUiDark:i,loadSmartConfig:Ge,usePKCE:he,togglePKCE:Ve,usePost:be,togglePost:We,intropectionIsPossible:ie,introspectToken:Ye,aud:U,setAud:rt,appId:C,setAppId:at,profile:W,fhirUser:Z,patientId:ne,requestedScopes:F,setRequestedScopes:ot,startAuth:Qe,refreshAuth:Ze,getFhirClient:it,toaster:He,copyToClipboard:Be};return a.a.createElement("div",{ref:e},a.a.createElement(f,{toggleSettingsVisible:Fe}),a.a.createElement(d.Overlay,{isOpen:g,onClose:Fe,className:d.Classes.OVERLAY_SCROLL_CONTAINER,usePortal:!1,autoFocus:!0,hasBackdrop:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0},a.a.createElement(d.Card,{className:"centered",interactive:!1,elevation:d.Elevation.TWO},a.a.createElement(d.H5,null,"Settings"),a.a.createElement(d.Divider,null),a.a.createElement(d.H6,null,"UI"),a.a.createElement(d.Switch,{checked:i,label:"Use Dark Theme",onChange:function(){s(!i)}}))),a.a.createElement(R,{common:st}),a.a.createElement(q,{info:{id:"smart-config-card",heading:"SMART Configuration",description:"",optional:!1},data:le,status:H,common:st}),a.a.createElement(q,{info:{id:"auth-info-card",heading:"Authorization Information",description:"",optional:!1},data:we,status:H,common:st}),a.a.createElement(q,{info:{id:"introspection-card",heading:"Token Introspection",description:"",optional:!1},data:Re,status:H,common:st}),function(){var e,t,n=[],r={isUiDark:i,loadSmartConfig:Ge,usePKCE:he,togglePKCE:Ve,usePost:be,togglePost:We,intropectionIsPossible:ie,introspectToken:Ye,aud:U,setAud:rt,appId:C,setAppId:at,profile:W,fhirUser:Z,patientId:ne,requestedScopes:F,setRequestedScopes:ot,startAuth:Qe,refreshAuth:Ze,getFhirClient:it,toaster:He,copyToClipboard:Be};return _e&&Ue&&n.push(a.a.createElement(z,{key:"data-user-card",title:"User Information",id:null!==(e=null===(t=B)||void 0===t?void 0:t.user.id)&&void 0!==e?e:void 0,resourceName:Ue,common:r})),Le.forEach((function(e){var t,o;switch(e){case"Patient":n.push(a.a.createElement(z,{key:"data-"+e+"-card",title:e+" Resource",id:null!==ne&&void 0!==ne?ne:void 0,resourceName:e,common:r}));break;case"Encounter":n.push(a.a.createElement(z,{key:"data-"+e+"-card",title:e+" Resource",id:null!==(t=null===(o=B)||void 0===o?void 0:o.encounter.id)&&void 0!==t?t:void 0,resourceName:e,common:r}));break;default:n.push(a.a.createElement(z,{key:"data-"+e+"-card",title:e+" Resource",id:void 0,resourceName:e,common:r}))}})),n}())}var K=function(){return a.a.createElement(G,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},83:function(e,t,n){"use strict";n.r(t),n.d(t,"patientCompartment",(function(){return r})),n.d(t,"fhirVersions",(function(){return a})),n.d(t,"patientParams",(function(){return o})),n.d(t,"SMART_KEY",(function(){return i}));var r=["Account","AdverseEvent","AllergyIntolerance","Appointment","AppointmentResponse","AuditEvent","Basic","BodySite","BodyStructure","CarePlan","CareTeam","ChargeItem","Claim","ClaimResponse","ClinicalImpression","Communication","CommunicationRequest","Composition","Condition","Consent","Coverage","CoverageEligibilityRequest","CoverageEligibilityResponse","DetectedIssue","DeviceRequest","DeviceUseRequest","DeviceUseStatement","DiagnosticOrder","DiagnosticReport","DocumentManifest","DocumentReference","EligibilityRequest","Encounter","EnrollmentRequest","EpisodeOfCare","ExplanationOfBenefit","FamilyMemberHistory","Flag","Goal","Group","ImagingManifest","ImagingObjectSelection","ImagingStudy","Immunization","ImmunizationEvaluation","ImmunizationRecommendation","Invoice","List","MeasureReport","Media","MedicationAdministration","MedicationDispense","MedicationOrder","MedicationRequest","MedicationStatement","MolecularSequence","NutritionOrder","Observation","Order","Patient","Person","Procedure","ProcedureRequest","Provenance","QuestionnaireResponse","ReferralRequest","RelatedPerson","RequestGroup","ResearchSubject","RiskAssessment","Schedule","ServiceRequest","Specimen","SupplyDelivery","SupplyRequest","VisionPrescription"],a={"0.4.0":2,"0.5.0":2,"1.0.0":2,"1.0.1":2,"1.0.2":2,"1.1.0":3,"1.4.0":3,"1.6.0":3,"1.8.0":3,"3.0.0":3,"3.0.1":3,"3.3.0":4,"3.5.0":4,"4.0.0":4,"4.0.1":4},o=["patient","subject","requester","member","actor","beneficiary"],i="SMART_KEY"}},[[261,1,2]]]);
//# sourceMappingURL=main.d05d7ad6.chunk.js.map